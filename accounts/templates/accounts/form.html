{% load widget_tweaks %}

{% if messages %}
  {% for message in messages %}
    {% if "open_modal" in message.tags %}
      <script>
        document.addEventListener("DOMContentLoaded", () => {
          const modal = new bootstrap.Modal(
            document.getElementById("addressModal")
          );
          modal.show();
        });
      </script>
    {% endif %}
  {% endfor %}
{% endif %}

<div class="modal fade" id="addressModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content border-0 shadow rounded-3">

      <!-- Header -->
      <div class="modal-header">
        <h5 class="modal-title fw-semibold">
          <i class="bi bi-geo-alt me-1"></i> Novo endereço
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- Body -->
      <div class="modal-body">
        <form action="{% url 'accounts:addaddress' %}" method="post">
          {% csrf_token %}

          {% if messages %}
            {% for message in messages %}
              <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
              </div>
            {% endfor %}
          {% endif %}

          <div class="row g-3">

            <!-- Nome -->
            <div class="col-12">
              <label class="form-label">{{ form.name.label }}</label>
              {% render_field form.name class="form-control" %}
            </div>

            <!-- Telefone / CEP -->
            <div class="col-md-6">
              <label class="form-label">{{ form.tel.label }}</label>
              {% render_field form.tel class="form-control" %}
            </div>

            <div class="col-md-6">
              <label class="form-label">{{ form.cep.label }}</label>
              {% render_field form.cep class="form-control" %}
            </div>

            <!-- Endereço / Número -->
            <div class="col-md-8">
              <label class="form-label">{{ form.address.label }}</label>
              {% render_field form.address class="form-control" %}
            </div>

            <div class="col-md-4">
              <label class="form-label">{{ form.number.label }}</label>
              {% render_field form.number class="form-control" %}
            </div>

            <!-- Complemento -->
            <div class="col-12">
              <label class="form-label">{{ form.complement.label }}</label>
              {% render_field form.complement class="form-control" %}
            </div>

            <!-- Bairro / Cidade -->
            <div class="col-md-6">
              <label class="form-label">{{ form.neighborhood.label }}</label>
              {% render_field form.neighborhood class="form-control" %}
            </div>

            <div class="col-md-6">
              <label class="form-label">{{ form.city.label }}</label>
              {% render_field form.city class="form-control" %}
            </div>

            <!-- Estado -->
            <div class="col-md-6">
              <label class="form-label">Estado</label>
              <select name="state" class="form-select" required>
                <option value="" selected disabled>Selecionar...</option>
                {% for state in states %}
                  <option value="{{ state }}">{{ state }}</option>
                {% endfor %}
              </select>
            </div>

          </div>

          <!-- Footer -->
          <div class="d-flex justify-content-end gap-2 mt-4">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
              Cancelar
            </button>
            <button type="submit" class="btn btn-success">
              Salvar endereço
            </button>
          </div>

        </form>
      </div>

    </div>
  </div>
</div>
