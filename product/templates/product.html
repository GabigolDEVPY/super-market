{% extends "base.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static "css/product.css" %}">
    <div class="display-form-product">
        <h3>{{ product.name }}</h3>
            <div class="product">
                <div>
                    {% include "carrousel.html" %}
                </div>
                <div>
                    <div class="product-right">
                        <label><span id="quantity">{{ quantity }}</span> dispon√≠veis</label>
                        {% if quantity > 0 %}
                            <p class="mb-0">
                                <p class="mb-0" style="color: #198754;">{% if product.discount %} {{ product.discount.discount }}% OFF {% endif %}</p>
                                <s id="product-discount" class="text-muted">{% if product.discount %}R$ <span>{{ product.price }}</span>{% endif %}</s>
                                <h3 class="text-success fw-bold">R$ <span id="price" >{{ product.apply_discount }}</span></h3>
                            </p>
                            
                            <form action="{% url 'cart:addcart' %}" method="post">
                                {% csrf_token %}
                                <div class="mb-3">
                                    <label for="exampleSelect" class="form-label">Change Option</label>
                                    <input type="hidden" name="id" value="{{ product.id }}">
                                    <select name="variantid" class="form-select" id="exampleSelect" aria-label="Selecione algo">
                                        {% for variation in variants %}
                                            <option data-discount="{{ variation.price }}" data-quantity="{{ variation.stock }}" data-preco="{{ variation.apply_discount }}" value="{{ variation.id }}">{{ variation.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="mb-3 w-25">
                                    <label for="quantity" class="form-label">Quantidade</label>
                                    <input style="width: 6vh;" type="number" name="quantity" id="quantity-max" class="form-control text-center" min="1" value="1" max="{{ quantity }}">
                                </div>
                                <button style="width: 26.8vh;" type="submit" class="btn btn-primary mt-auto">add to cart</button>
                            </form>
                            <a style="margin-top: 4px;" class="btn btn-success" href="{% url "product:buynow" product.id %}">buy now</a>
                        {% endif %}
                    </div>
                </div>

            </div>
        <h3>{{ product.description }}</h3>
    </div>
<script>
    const selectVariation = document.getElementById("exampleSelect");
    const priceElemeent = document.getElementById("price");
    const quantity = document.getElementById("quantity")
    const newQuantityMax = document.getElementById("quantity-max")
    const QuantityDiscount = document.getElementById("product-discount")

    selectVariation.addEventListener("change", function () {
        const selectedOption = this.options[this.selectedIndex];
        const newPrice = selectedOption.getAttribute("data-preco");
        const newQuantity = selectedOption.getAttribute("data-quantity");
        const newDiscountPrice = selectedOption.getAttribute("data-discount");
        newQuantityMax.max = selectedOption.getAttribute("data-quantity");
        newQuantityMax.value = 1;


        if (QuantityDiscount) {
            QuantityDiscount.innerText = newDiscountPrice.replace();
        }
        if (newPrice) {
            priceElemeent.innerText = newPrice.replace(".", ",");
        }
        if (newQuantity) {
            quantity.innerText = newQuantity.replace();
        }
    });

</script>
{% endblock content %}
