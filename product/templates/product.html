{% extends "base.html" %}
{% block content %}

<div class="container my-5">
  <div class="row g-5">

    <!-- GALERIA -->
    <div class="col-lg-7 text-center">

      <img
        id="mainImage"
        src="{{ product.image.url }}"
        class="img-fluid rounded shadow mb-4"
        style="width:600px;"
        alt="{{ product.name }}"
      >

        {% if images|length > 1 %}
            <div class="d-flex justify-content-center gap-3 flex-wrap">
                {% for image in images %}
                    <img src="{{ image.url|default:image }}"
                    class="img-thumbnail shadow active"
                    width="90"
                    onclick="changeImage(this.src, this)">
                {% endfor %}
            </div>
        {% endif %}
    </div>

        
    <div class="col-lg-5">
      <div class="bg-white shadow rounded p-4 h-100 d-flex flex-column">

        <span class="badge bg-success mb-3">DisponÃ­veis <strong id="quantity">{{ quantity }}</strong></span>

        <h1 class="h4 fw-bold">{{ product.name }}</h1>

        <div class="mb-4">
            {% if product.discount %}
                <span id="product-discount" class="text-decoration-line-through text-muted me-2">R$ {{ product.price }}</span>
                <span class="text-success fw-bold">{{ product.discount }}</span><br>
            {% endif %}
            <span id="price" class="fs-2 fw-bold text-success">R$ {{ product.apply_discount }}</span><br>
            <span class="fs-6">em atÃ© <strong>12x de {{ product.twelvetimes }} sem juros</strong></span>
        </div>
        <form action="{% url 'cart:addcart' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="id" value="{{product.id}}">
            <div class="mb-4">
                <label class="form-label fw-semibold">Cor</label>
                <select class="form-select" name="variantid" id="exampleSelect" required>
                    {% for variant in variants %}
                        <option value="{{ variant.id }}" data-preco="{{ variant.apply_discount }}" data-quantity="{{ variant.stock }}" data-discount="{{ variant.price }}">{{ variant.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="w-25">
                <label class="form-label fw-semibold">
                    Quantidade
                </label>
                <input
                    type="number" name="quantity" id="quantity-max" class="form-control text-center mb-4" min="1" max="{{ quantity }}" value="1"
                >
            </div>
            {% if messages %}
                {% for message  in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show alert-danger" role="alert">
                        {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
            <div class="mt-auto">
                <div class="d-grid gap-3">
                    <button type="submit" class="btn btn-success btn-lg">Adicionar ao carrinho</button>
                    <a href="{% url 'product:buynow' product.id %}" class="btn btn-outline-primary btn-lg">Comprar agora</a>
                </div>
        </form>

            <div class="border-top pt-3 small text-muted">
                <div>ðŸ›¡ Compra 100% segura</div>
                <div>ðŸ”„ Garantia de 30 dias</div>
                <div>ðŸšš Frete grÃ¡tis acima de R$ 299</div>
            </div>
        </div>

      </div>
    </div>
  </div>
</div>

<script>
    const selectvariant = document.getElementById("exampleSelect");
    const priceElemeent = document.getElementById("price");
    const quantity = document.getElementById("quantity");
    const newQuantityMax = document.getElementById("quantity-max");
    const QuantityDiscount = document.getElementById("product-discount");

    if (selectvariant) {
        selectvariant.addEventListener("change", function () {
            const selectedOption = this.options[this.selectedIndex];

            const newPrice = selectedOption.getAttribute("data-preco");
            const newQuantity = selectedOption.getAttribute("data-quantity");
            const newDiscountPrice = selectedOption.getAttribute("data-discount");

            newQuantityMax.max = newQuantity;
            newQuantityMax.value = 1;

            if (QuantityDiscount && newDiscountPrice) {
                QuantityDiscount.innerText = "R$ " + newDiscountPrice;
            }

            if (newPrice) {
                priceElemeent.innerText = newPrice.replace(".", ",");
            }

            if (newQuantity) {
                quantity.innerText = newQuantity;
            }
        });
    }
function changeImage(src, elem) {
  document.getElementById("mainImage").src = src;
  document.querySelectorAll('.img-thumbnail').forEach(img => img.classList.remove('border-primary'));
  elem.classList.add('border-primary');
}

function calcularFrete() {
  document.getElementById("freteInfo").innerText =
    "Frete grÃ¡tis â€¢ Entrega em atÃ© 5 dias Ãºteis";
}
</script>

{% endblock content %}
