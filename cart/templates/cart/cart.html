{% extends "base.html" %}

{% block title %}Carrinho{% endblock %}

{% block content %}
<div class="container pt-5 mt-4">

{% if items_cart %}
    <div class="row g-4">

        <!-- LISTA DE PRODUTOS -->
        <div class="col-lg-8">
            <div class="card shadow-sm border-0 rounded-3 p-4">

                <h4 class="fw-bold mb-4">Carrinho de compras</h4>

                <div class="vstack gap-3" style="max-height: 420px; overflow-y: auto;">

                    {% for item in items_cart %}
                    <div class="card border-0 shadow-sm">
                        <div class="row g-0 align-items-center">

                            <!-- Imagem -->
                            <div class="col-4 col-md-3 p-3 text-center">
                                <img
                                    src="{{ item.product.image.url }}"
                                    alt="{{ item.product.name }}"
                                    class="img-fluid rounded"
                                    style="max-height: 120px; object-fit: cover;"
                                >
                            </div>

                            <!-- Info -->
                            <div class="col-8 col-md-6">
                                <div class="card-body py-2">
                                    <h6 class="fw-semibold mb-2">
                                        {{ item.product.name }}
                                    </h6>

                                    <p class="mb-1 text-muted small">
                                        Quantidade: <strong>{{ item.quantity }}</strong>
                                    </p>

                                    <p class="mb-2 text-muted small">
                                        Variação: <strong>{{ item.variant.name }}</strong>
                                    </p>

                                    <span class="fw-bold text-success fs-5">
                                        R$ {{ item.variant.apply_discount }}
                                    </span>
                                </div>
                            </div>

                            <!-- Remover -->
                            <div class="col-12 col-md-3 text-center text-md-end p-3">
                                <form action="{% url 'cart:cartremove' %}" method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="variant_id" value="{{ item.variant.id }}">
                                    <input type="hidden" name="id" value="{{ item.id }}">
                                    <button class="btn btn-outline-danger btn-sm">
                                        Remover
                                    </button>
                                </form>
                            </div>

                        </div>
                    </div>
                    {% endfor %}

                </div>
            </div>
        </div>

        <!-- RESUMO -->
        <div class="col-lg-4">
            <div class="card shadow-sm border-0 rounded-3 p-4">

                <h5 class="fw-bold mb-3">Resumo do pedido</h5>

                <p class="mb-2">
                    Itens no carrinho:
                    <strong>{{ items_cart|length }}</strong>
                </p>

                <hr>

                <div class="mb-3">
                    <span class="text-muted">Total</span>
                    <h3 class="fw-bold text-success">
                        R$ {{ cart_price }}
                    </h3>
                </div>

                <ul class="list-unstyled small text-muted mb-4">
                    <li class="mb-1">
                        <i class="bi bi-truck me-1 text-success"></i>
                        Frete grátis para todo o Brasil
                    </li>
                    <li class="mb-1">
                        <i class="bi bi-credit-card me-1 text-primary"></i>
                        Até 12x sem juros
                    </li>
                    <li>
                        <i class="bi bi-shield-check me-1 text-secondary"></i>
                        Pagamento seguro
                    </li>
                </ul>

                <div class="mb-3">
                    <a href="{% url 'accounts:home' %}" class="small text-decoration-none">
                        + Adicionar endereço
                    </a>
                </div>

                <form action="{% url 'cart:cartbuy' %}" method="post">
                    {% csrf_token %}
                    <select name="address" class="form-select mb-3" required>
                        <option value="" selected disabled>Selecionar endereço...</option>
                        {% for address in address %}
                            <option value="{{ address.id}}">
                                {{ address.name }}
                            </option>
                        {% endfor %}
                    </select>

                    <button class="btn btn-success w-100 py-2 fs-5">
                        Finalizar compra
                    </button>
                </form>

            </div>
        </div>

    </div>

    <!-- RECOMENDADOS -->
    <div class="card border-0 shadow-sm rounded-3 p-3 mt-5">
        <h5 class="fw-semibold mb-3">
            Você também pode gostar
        </h5>
        {% include "cart/scroll-product.html" %}
    </div>

{% else %}

    <!-- CARRINHO VAZIO -->
    <div class="d-flex flex-column align-items-center justify-content-center text-center" style="min-height: 60vh;">
        <i class="bi bi-cart-x fs-1 text-muted mb-3"></i>
        <h5 class="text-muted mb-4">
            Seu carrinho está vazio
        </h5>
        <a href="{% url 'market:home' %}" class="btn btn-primary">
            Ir para produtos
        </a>
    </div>

{% endif %}
</div>
{% endblock content %}
